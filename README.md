# MySQL 慢查詢分析儀表板 (LogSlowqueryDashboard)

一個專業的 MySQL 慢查詢分析 Dashboard，提供直觀的 Web 介面來分析和監控資料庫效能問題。

## ✨ 主要功能

### 📊 四大分析模組
- **樣板統計分析**：將相似 SQL 查詢歸類為樣板，分析執行頻率和效能
- **原始查詢列表**：完整的慢查詢記錄檢視，支援多維度篩選和排序
- **效能分析圖表**：提供視覺化統計圖表，包含分布圖、排行榜等
- **檔案管理系統**：支援多個 LOG 檔案上傳、切換、合併功能

### 🎯 核心特色
- **多檔案支援**：上傳多個 MySQL 慢查詢 LOG 檔案並靈活切換分析
- **檔案合併功能**：將多個分析結果合併產生綜合報告
- **智能篩選系統**：支援 SQL 類型、執行時間、資料表名稱、關鍵字等多維度篩選
- **完整排序功能**：所有資料表格支援點擊欄位標題進行升序/降序排列
- **詳細資訊彈窗**：點擊 SQL 查詢可檢視完整內容並支援一鍵複製
- **響應式設計**：自適應不同螢幕尺寸，完美支援桌面和行動裝置

### 🔍 進階分析功能
- **快速篩選按鈕**：一鍵篩選 > 10秒、> 30秒、> 1分鐘執行時間的查詢
- **高負載查詢檢測**：快速找出檢查行數 > 10萬、> 100萬的查詢
- **SQL 效能評級**：自動評估查詢效能等級（優秀/良好/普通/較差/極差）
- **資料表使用分析**：統計各資料表的查詢頻率和效能影響
- **用戶活動統計**：分析不同用戶的查詢行為模式

### 📈 視覺化報表
- **SQL 類型分布圓餅圖**：SELECT、UPDATE、INSERT、DELETE 等類型占比
- **執行時間分布長條圖**：不同時間區間的查詢數量統計
- **用戶活動橫向長條圖**：各用戶的查詢數量排行
- **資料表使用統計**：熱門資料表的查詢頻率分析

## 🚀 快速開始

### 系統需求
- **Python**：3.7 或更高版本
- **瀏覽器**：Chrome 70+、Firefox 65+、Safari 12+、Edge 79+
- **作業系統**：Windows、macOS、Linux

### 安裝與啟動

1. **下載專案**
```bash
git clone <your-repository-url>
cd LogSlowqueryDashboard
```

2. **安裝相依套件**
```bash
pip install -r requirements.txt
```

3. **啟動伺服器**
```bash
python server.py
```

4. **開啟網頁介面**
```
瀏覽器訪問：http://localhost:8000
```

## 📁 專案結構

```
LogSlowqueryDashboard/
├── server.py                    # FastAPI 主伺服器
├── templates/
│   └── index.html              # Dashboard 前端介面
├── parsed_slow_log.py          # MySQL LOG 檔案解析模組
├── normalized_sql_summary.py   # SQL 樣板標準化與統計模組
├── analysis_data/              # 使用者上傳的分析資料目錄
├── requirements.txt            # Python 相依套件清單
├── README.md                   # 專案說明文件
├── .gitignore                  # Git 版本控制忽略檔案
└── mysql-slow.log-*           # 範例 MySQL 慢查詢日誌檔案
```

## 💻 使用指南

### 🔺 步驟 1：上傳 MySQL 慢查詢日誌
1. 點擊「檔案管理」標籤頁
2. 選擇「上傳新的 LOG 檔案」
3. 上傳 MySQL 慢查詢日誌檔案（支援 .log、.txt 格式）
4. 輸入分析名稱（建議使用有意義的名稱）
5. 等待系統自動解析與分析

### 🔺 步驟 2：查看分析結果
- **樣板統計**：檢視 SQL 樣板的執行統計和效能指標
- **原始查詢列表**：瀏覽完整的慢查詢記錄
- **效能分析**：透過圖表了解整體效能狀況

### 🔺 步驟 3：進階操作
- **切換分析檔案**：比較不同時期或系統的效能
- **合併多個檔案**：產生跨時間段的綜合報告
- **匯出分析結果**：下載統計報告供後續使用

### 🔍 篩選與搜尋技巧
- 使用**快速篩選按鈕**快速定位問題查詢
- 利用**關鍵字搜尋**找到特定的 SQL 語句
- 透過**執行時間篩選**專注於高耗時查詢
- 使用**資料表篩選**分析特定表格的效能

## 🎨 功能展示

### 樣板統計分析
- 📊 SQL 樣板歸類與統計
- ⏱️ 平均執行時間分析
- 🔢 執行次數統計
- 📋 使用的資料表清單

### 原始查詢檢視
- 📝 完整的慢查詢記錄
- 🕐 詳細的時間戳資訊
- 👤 用戶與主機資訊
- 📊 執行統計（查詢時間、鎖定時間、檢查行數）

### 效能分析圖表
- 🥧 SQL 類型分布圓餅圖
- 📊 執行時間分布統計
- 👥 用戶活動分析
- 🗃️ 資料表使用頻率

### 檔案管理功能
- 📤 拖拽上傳支援
- 🔄 多檔案快速切換
- 🔗 檔案合併功能
- 🗑️ 分析資料管理

## 🔧 技術架構

### 後端技術棧
- **FastAPI**：現代化、高效能的 Python Web 框架
- **Uvicorn**：ASGI 伺服器，支援非同步處理
- **Jinja2**：功能強大的模板引擎
- **Python Multipart**：檔案上傳處理

### 前端技術棧
- **Bootstrap 5**：響應式 UI 設計框架
- **jQuery 3.x**：JavaScript 函式庫
- **DataTables**：進階表格功能（排序、分頁、搜尋、匯出）
- **Chart.js**：互動式圖表視覺化函式庫
- **Select2**：增強型下拉選單元件
- **Font Awesome**：向量圖標字體庫

## 📊 支援的日誌格式

本系統支援標準的 MySQL 慢查詢日誌格式，解析以下欄位：

```sql
# Time: 2024-05-31T10:30:45.123456Z
# User@Host: user[user] @ hostname [1.2.3.4]
# Query_time: 12.345678  Lock_time: 0.000123  Rows_sent: 1  Rows_examined: 1000000
SELECT * FROM large_table WHERE condition = 'value';
```

### 解析欄位說明
- **Time**：查詢執行的時間戳
- **User@Host**：執行查詢的用戶名稱與來源主機
- **Query_time**：SQL 查詢的總執行時間（秒）
- **Lock_time**：等待鎖定的時間（秒）
- **Rows_sent**：回傳給客戶端的資料行數
- **Rows_examined**：MySQL 引擎檢查的資料行數
- **SQL Statement**：完整的 SQL 查詢語句

## 🚨 效能調優建議

基於分析結果，系統會自動提供以下建議：

### 🔴 高優先級問題
- 執行時間 > 30秒的查詢
- 檢查行數 > 100萬的查詢
- 缺少索引的大表掃描

### 🟡 中優先級問題  
- 執行時間 10-30秒的查詢
- 檢查行數 10萬-100萬的查詢
- 頻繁執行的低效查詢

### 🟢 優化建議
- 添加適當的資料庫索引
- 優化 WHERE 條件子句
- 考慮分表或分區策略
- 檢討 JOIN 操作的效率

## 🤝 貢獻與支援

### 問題回報
如果您發現任何問題或有功能建議，請：
1. 查看現有的 Issues
2. 建立新的 Issue 並詳細描述問題
3. 提供相關的錯誤訊息或截圖

### 開發環境設置
```bash
# 克隆專案
git clone <repository-url>
cd LogSlowqueryDashboard

# 建立虛擬環境
python -m venv venv
source venv/bin/activate  # Linux/macOS
# 或
venv\Scripts\activate     # Windows

# 安裝開發相依套件
pip install -r requirements.txt

# 啟動開發伺服器
python server.py
```

## 📄 授權條款

本專案採用 MIT 授權條款，詳見 LICENSE 檔案。

---

**💡 提示**：建議在生產環境使用前，先在測試環境中驗證所有功能是否正常運作。